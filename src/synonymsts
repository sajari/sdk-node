import { Client } from "./client";
import { SynonymsApi, V4alpha1CreateSynonymRequest } from "../src/generated/api";

export { withEndpoint, withKeyCredentials } from "./client";

export class SynonymsClient extends Client {
  collectionId: string;

  client: SynonymsApi;

  constructor(
    accountId: string,
    collectionId: string,
    ...options: Array<(client: Client) => void>
  ) {
    super(accountId, ...options);

    this.collectionId = collectionId;

    this.client = new SynonymsApi(this.endpoint);
    this.client.username = this.keyId;
    this.client.password = this.keySecret;
  }

  async createSynonym(request: Omit<V4alpha1CreateSynonymRequest, "parent">) {
    const parent = this.parentParts().join("/");
    const res = await this.client.createSynonym(parent, {
      ...request,
      parent,
    });
    return res.body;
  }

  async getSynonym(id: string) {
    const res = await this.client.getSynonym(this.resourceName(id));
    return res.body;
  }

  private resourceName(id: string) {
    return [...this.parentParts(), "synonyms", encodeURIComponent(id)].join(
      "/"
    );
  }

  private parentParts() {
    return [
      "accounts",
      encodeURIComponent(this.accountId),
      "collections",
      encodeURIComponent(this.collectionId),
    ];
  }
}
